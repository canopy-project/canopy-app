<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Canopy - An Open Source Platform for the Internet of Things</title>
    <script>
        var CUI_INCLUDE_PATH = "canopy-web-ui/www"
        var DM_INCLUDE_PATH = "www"
    </script>
    <script src="canopy-web-ui/www/cui_include.js"></script>
    <script src="www/dm_include.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    <script type="text/javascript" src="//www.google.com/jsapi"></script>
    <script src="canoweb.conf.js"></script>
    <script>
        document.write('<script src="' + gCanopyWebAppConfiguration.javascriptClientURL + '" type="text/javascript"><\/script>');
    </script>
    <script src="canopy_app_util.js"></script>
    <script src="nodes/cano.js"></script>
    <script src="nodes/cano_account_password_section.js"></script>
    <script src="nodes/cano_account_profile_section.js"></script>
    <script src="nodes/cano_account_sidebar.js"></script>
    <script src="nodes/cano_account_upgrade_section.js"></script>
    <script src="nodes/cano_analytics_histogram_widget.js"></script>
    <script src="nodes/cano_analytics_no_devices.js"></script>
    <script src="nodes/cano_analytics_widget.js"></script>
    <script src="nodes/cano_apps_list.js"></script>
    <script src="nodes/cano_apps_page.js"></script>
    <script src="nodes/cano_apps_sidebar.js"></script>
    <script src="nodes/cano_device_no_devices_msg.js"></script>
    <script src="nodes/cano_option.js"></script>
    <script src="nodes/cano_popup.js"></script>
    <script src="nodes/cano_switcher.js"></script>
    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,700|ABeeZee|Titillium+Web:200,300,400,700' rel='stylesheet' type='text/css'>
    <link href='canoweb.css' rel='stylesheet' type='text/css'>
</head>

<body style='min-width: 800px; background:#ffffff'>

<div id=main></div>

</body>
<script>

Canopy.initUserClient({
    // TODO: other settings?
    "host" : gCanopyWebAppConfiguration.cloudHost,
}).onDone(function(result, data) {
    if (result != CANOPY_SUCCESS) {
        // Error getting selfUser.  Probably not logged in.
        window.location.replace("login.html");
        return;
    }

    // TODO: use "v" in query
    data.user.organization(cuiNavState.get("v")).onDone(function(result2, data2) {
        if (result2 != CANOPY_SUCCESS) {
            alert("Problem generating org view");
            var main = new DmMain({
                user: data.user, 
            });
        } else {
            var main = new DmMain({
                user: data.user, 
                viewer: data2.org
            });
        }

        $("#main").html(main.get$());
        main.live();
    });
});

</script>

</html>



