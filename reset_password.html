<!DOCTYPE html>
<!--
-->
<html>

<head>
    <title>Canopy - An Open Source Platform for the Internet of Things</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="canoweb.conf.js"></script>
    <script>
        document.write('<script src="' + gCanopyWebAppConfiguration.javascriptNewClientURL + '" type="text/javascript"><\/script>');
    </script>
    <script src="canopy_app_util.js"></script>
    <script src="nodes/cano.js"></script>
    <script src="nodes/cano_topbar.js"></script>
    <script src="nodes/cano_account_page.js"></script>
    <script src="nodes/cano_account_sidebar.js"></script>
    <script src="nodes/cano_device_list.js"></script>
    <script src="nodes/cano_device_details.js"></script>
    <script src="nodes/cano_device_details_details.js"></script>
    <script src="nodes/cano_device_details_vars.js"></script>
    <script src="nodes/cano_devices_page.js"></script>
    <script src="nodes/cano_devices_sidebar.js"></script>
    <script src="nodes/cano_devices_create.js"></script>
    <script src="nodes/cano_account_dropdown.js"></script>
    <script src="nodes/cano_device_no_devices_msg.js"></script>
    <script src="nodes/cano_editable.js"></script>
    <script src="nodes/cano_main_page.js"></script>
    <script src="nodes/cano_option.js"></script>
    <script src="nodes/cano_switcher.js"></script>
    <script src="canoweb_dispatcher.js"></script>
    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,700|ABeeZee|Titillium+Web:200,300,400,700' rel='stylesheet' type='text/css'>
    <link href='canoweb.css' rel='stylesheet' type='text/css'>
</head>

<body style='min-width: 800px; background:#ffffff'>

<div class='main-outer' id=main>
    <div class='topbar'>
        <div class='topbar-inner'>
            <div class='topbar-left-part noselect'>
                <a href='http://canopy.link'><div class='topbar-logo'>Canopy</div></a>
            </div>
            <div class='topbar-middle-part w400' style='color:#000000'>
                Device Manager<span id=host_title></span>
            </div>
            <div class='topbar-right-part' style='width:200px;'>&nbsp;
            </div>
        </div>
    </div>
    <div style='height:58px;'>&nbsp;</div>

    <div id='request_form' class='centered' style='background:#f0f0f0; padding-top:30px'>
        <div style='display:inline-block; text-align:left'>
            <br><br><div class='l'>Password Reset Request</div>
            
            <div id='request_form_inner'>
                <div id=errormsg style='font-style:italic; color:#ff0000; display:none;'></div>

                <table cellpadding=16>
                    <tr>
                        <td>Username or Email:</td>
                        <td><input id=request_username type=text></input></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><input type=submit id=request_btn value='Request Password Reset'></input></td>
                    </tr>
                </table>
            </div>

            <div id=request_sent_msg style='display:none;'>
            <b>Check your email!</b> An email will been sent with instructions to the email address on
            file, if any.
            </div>

            <br><br>
            <br>
            <br>
            <br>
            <br>
        </div>
    </div>
   
    <div id='reset_form' class='centered' style='display: none; background:#f0f0f0; padding-top:30px'>
        <div style='display:inline-block; text-align:left'>
            <br><br><div class='l'>Reset Your Password</div>
            
            <div id='reset_form_inner'>
                <div id=errormsg2 style='font-style:italic; color:#ff0000; display:none;'></div>

                <table cellpadding=16>
                    <tr>
                        <td>Username: </td>
                        <td><b id=reset_username></b></td>
                    </tr>
                    <tr>
                        <td>New Password: </td>
                        <td><input id=reset_password type=password></input></td>
                    </tr>
                    <tr>
                        <td>Confirm New Password: </td>
                        <td><input id=reset_confirm_password type=password></input></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><input type=submit id=reset_btn value='Set New Password'></input></td>
                    </tr>
                </table>
            </div>

            <div id=reset_complete_msg style='display:none;'>
                Your password has been changed.
                <br><br>
                Go to <a href='index.html'>Device Manager</a>.
            </div>

            <br><br>
            <br>
            <br>
        </div>
    </div>
    

    <center class=bg-blue-gradient style='padding-top:00px; padding-bottom:30px' >
        <table width=800>
            <tr>
                <td valign=bottom>
                    <img style='position: relative; top:15px;' class=frontpage-cloudplug-img src=images/cloud_circuit_h256.png></img>
                </td>
                <td valign=center>
                    <div class='l' style=''>Canopy Device Manager</div>
                    <ul>
                        <li>Monitor, control and share your Canopy-enabled devices.</li>
                        <li>Advanced administrative tools for device makers.</li>
                        <li>100% open source.</li>
                    </ul>
                </td>
            </tr>
        </table>
        <div style='font-size: 16px'>
            Twitter:
            <a target=_blank style='color:#ffff80; font-weight:400;' href='http://twitter.com/CanopyIoT'>
                @CanopyIoT
            </a>
            <div style='display:inline-block; width:50px'></div>
            Email:
            <a target=_blank style='color:#ffff80; font-weight:400;' href='mailto:info@canopy.link'>
                info@canopy.link
            </a>
            <div style='display:inline-block; width:50px'></div>
            GitHub:
            <a target=_blank style='color:#ffff80; font-weight:400;' href='http://github.com/canopy-project'>
                github.com/canopy-project
            </a>
            <div style='display:inline-block; width:50px'></div>
            Forum
            <a target=_blank style='color:#ffff80; font-weight:400;' href='http://canopy.lefora.com'>
                canopy.lefora.com
            </a>
        </div>
    </center>

    <center>
            <br><div style='font-size:16px'>Copyright 2014-2015 SimpleThings, Inc.</div>
    </center>
</div>

</body>
<script>

var ctx = Canopy.initContext();
var remote = ctx.initRemote({
    // TODO: other settings?
    "host" : gCanopyWebAppConfiguration.cloudHost
});

var urlParams = CanopyUtil_GetURLParams();
    $("#reset_username").html(urlParams["username"]);

if (urlParams["code"]) {
    $("#request_form").hide();
    $("#reset_form").show();
}
$("#request_btn").off('click').on('click', function() {
    $("#errormsg").slideUp();

    remote.requestPasswordReset({
        "username" : $("#request_username").val()
    }).onDone(function(result, data) {
        if (result != CANOPY_SUCCESS) {
            $("#errormsg").html("Error requesting password reset.");
            $("#errormsg").slideDown();
            return;
        }
        $("#request_form_inner").slideUp();
        $("#request_sent_msg").slideDown();
    });
});

$("#reset_btn").off('click').on('click', function() {
    $("#errormsg2").slideUp();

    remote.resetPassword({
        "username" : urlParams["username"],
        "password" : $("#reset_password").val(),
        "confirmPassword" : $("#reset_confirm_password").val(),
        "code" : urlParams["code"]
    }).onDone(function(result, data) {
        if (result != CANOPY_SUCCESS) {
            $("#errormsg2").html("Error setting new password.");
            $("#errormsg2").slideDown();
            return;
        }
        $("#reset_form_inner").slideUp();
        $("#reset_complete_msg").slideDown();
    });
});

$("#host_title").html(" for " + gCanopyWebAppConfiguration.cloudHost);

</script>

</html>



